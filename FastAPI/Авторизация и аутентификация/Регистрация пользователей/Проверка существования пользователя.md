Проверка на уровне базы данных:
```python
from src.database import Base  
from sqlalchemy.orm import Mapped, mapped_column  
from sqlalchemy import String  
  
  
class UsersORM(Base):  
    __tablename__ = 'users'  
	  
    id: Mapped[int] = mapped_column(primary_key=True)  
    email: Mapped[str] = mapped_column(String(length=200), unique=True)  
```
<mark style="background: #ABF7F7A6;">unique=True</mark> - добавляет полю уникальности.

В таком случе при попытке создать пользователя уникальное поле которого повторяется будет ошибка на уровне [[PostgreSQL]]. А сервер упадёт со [[Статус коды]] 500 (ошибка сервера).

Проверка после получения пользователя:
```python
@router.post("/register", description="Регистрация пользователя")  
async def register_user(  
        data: UserRequestAdd  
):  
    hashed_password = pwd_context.hash(data.password)  
	  
    new_data = data.model_dump(exclude={"password"})
    new_user_data = UserAdd(**new_data, hashed_password=hashed_password)  
	
    async with async_session_maker() as session:  
	    user = "тут получаем пользователя"
	    if user:
		    "если юзер найден, то ошибка"
		else:
			"тут добавляем пользователя"
	        await UsersRepository(session).add(new_user_data)  
	    await session.commit()  
  
    return {"status": "ok"}
```
Проблема подхода в том, что внутри [[Session]] проходит два запроса, что не есть хорошо.
Лучше использовать первый способ и обработать ошибку.