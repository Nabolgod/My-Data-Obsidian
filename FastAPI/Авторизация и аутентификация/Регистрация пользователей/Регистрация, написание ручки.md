### Первое 

Cоздадим новый [[Роутеры]] , которй будет связан с аутентификацией в файле <mark style="background: #ABF7F7A6;">auth</mark>.py:
```python
from fastapi import APIRouter
from src.schemas.users import UserRequestAdd, UserAdd
from repositories.users import UsersRepository
from src.database import async_session_maker


router = APIRouter(prefix="/auth", tags=["Авторизация и аутентификация"])

@router.post("/register")
async def register_user(
	data: UserRequestAdd,
):
	hashed_password = ""
	new_user_data = UserAdd(email=data.email, hash_password=hashed_password)
	
	async with async_session_maker(email.) as session:
		await UsersRepository(session).add(new_user_data)
		await session.commit()
	
	return {"status": "ok"}
```
При добавлении данных или когда используем передачу чувствительных данных (пароли, ключи) мы используем <mark style="background: #ADCCFFA6;">post</mark>.
<mark style="background: #ADCCFFA6;">hashed_password</mark>  - в эту переменную мы запишем хэш после [[Хэширование паролей]].

Не забываем добавить наш роутер в [[main]] файл, чтобы он отображался в главном приложении. Причём указываем его первее, чем все остальные роутеры, т.к. регистрация происходит раньше.
### Второе 

Cоздадим [[Pydantic]] схему для работы с данными user а файле <mark style="background: #FFF3A3A6;">users</mark>.py:
```python
from pydantic import BaseModel, ConfigDict, EmailStr


class UserRequestAdd(BaseModel):
	email: EmailStr
	password: str


class UserAdd(BaseModel):
	email: EmailStr
	hashed_password: str


class User(BaseModel):
	id: int
	email: EmailStr
	
	model_config = ConfigDict(from_attributes=True)
```
<mark style="background: #FFF3A3A6;">EmailStr</mark> - специальный тип для валидации email.

Так как изначально мы работаем с сырым паролем нам необходимо продумать вторую схему, которая будет отправляться в базу данных с хэш_паролем.

Тут нужно подумать, кака схема будет использоваться для отдачи информации из базы данных. Мы не хотим отдавать какую-либо информацию, связанную с паролем, поэтому с схеме User мы его не указываем.
### Третье

Cоздаём [[Репозиторий (DAO)]] для пользователей:
```python
from src.repositories.base import BaseRepository  
from src.schemes.users import User
from src.models.users import UserORM
  
  
class UsersRepository(BaseRepository):  
    model = UserORM  
    scheme = User  
```
